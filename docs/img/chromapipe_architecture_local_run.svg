<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 520" font-family="'Segoe UI', system-ui, -apple-system, sans-serif">
  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#0f172a"/>
      <stop offset="100%" stop-color="#1e293b"/>
    </linearGradient>
    <filter id="glow">
      <feGaussianBlur stdDeviation="2" result="blur"/>
      <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
    </filter>
    <marker id="arrow" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto-start-auto">
      <path d="M 0 0 L 10 3.5 L 0 7 z" fill="#64748b"/>
    </marker>
    <marker id="arrow-blue" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto-start-auto">
      <path d="M 0 0 L 10 3.5 L 0 7 z" fill="#38bdf8"/>
    </marker>
    <marker id="arrow-green" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto-start-auto">
      <path d="M 0 0 L 10 3.5 L 0 7 z" fill="#34d399"/>
    </marker>
    <marker id="arrow-purple" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto-start-auto">
      <path d="M 0 0 L 10 3.5 L 0 7 z" fill="#a78bfa"/>
    </marker>
    <marker id="arrow-orange" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto-start-auto">
      <path d="M 0 0 L 10 3.5 L 0 7 z" fill="#fb923c"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="900" height="520" fill="url(#bg)" rx="12"/>

  <!-- Title -->
  <text x="450" y="38" text-anchor="middle" fill="#f1f5f9" font-size="18" font-weight="600" letter-spacing="0.5">ChromApipe — Pipeline Architecture</text>
  <text x="450" y="56" text-anchor="middle" fill="#64748b" font-size="11">Nextflow DSL2  ·  Docker  ·  22 Autosomes  ·  500kb Resolution</text>

  <!-- ═══════════════ INPUT ═══════════════ -->
  <rect x="30" y="82" width="140" height="100" rx="8" fill="#1e293b" stroke="#334155" stroke-width="1.2"/>
  <text x="100" y="104" text-anchor="middle" fill="#94a3b8" font-size="9" font-weight="600" letter-spacing="1">INPUT</text>
  <line x1="55" y1="112" x2="145" y2="112" stroke="#334155" stroke-width="0.8"/>
  <text x="100" y="132" text-anchor="middle" fill="#e2e8f0" font-size="11" font-weight="500">chr 1–22</text>
  <text x="100" y="150" text-anchor="middle" fill="#64748b" font-size="9">Channel.fromList</text>
  <text x="100" y="168" text-anchor="middle" fill="#475569" font-size="8">parallel emission</text>

  <!-- ═══════════════ STAGE 1: fetch_pdb ═══════════════ -->
  <rect x="220" y="82" width="160" height="100" rx="8" fill="#0c2d48" stroke="#38bdf8" stroke-width="1.2"/>
  <circle cx="236" cy="100" r="8" fill="#38bdf8" opacity="0.2"/>
  <text x="236" y="104" text-anchor="middle" fill="#38bdf8" font-size="9" font-weight="700">1</text>
  <text x="308" y="104" text-anchor="middle" fill="#38bdf8" font-size="11" font-weight="600">fetch_pdb</text>
  <line x1="240" y1="112" x2="360" y2="112" stroke="#1e3a5f" stroke-width="0.8"/>
  <text x="300" y="132" text-anchor="middle" fill="#cbd5e1" font-size="9">GitHub Release</text>
  <text x="300" y="146" text-anchor="middle" fill="#64748b" font-size="8">v.0.1-data / local PDB</text>
  <rect x="240" y="155" width="120" height="18" rx="4" fill="#0f3460" stroke="#1e3a5f"/>
  <text x="300" y="167" text-anchor="middle" fill="#7dd3fc" font-size="8">→ chr{N}.pdb</text>

  <!-- Arrow: input → fetch_pdb -->
  <line x1="170" y1="132" x2="218" y2="132" stroke="#64748b" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- ═══════════════ STAGE 2: compute_physical ═══════════════ -->
  <rect x="440" y="82" width="190" height="130" rx="8" fill="#0a2e1f" stroke="#34d399" stroke-width="1.2"/>
  <circle cx="458" cy="100" r="8" fill="#34d399" opacity="0.2"/>
  <text x="458" y="104" text-anchor="middle" fill="#34d399" font-size="9" font-weight="700">2</text>
  <text x="543" y="104" text-anchor="middle" fill="#34d399" font-size="11" font-weight="600">compute_physical</text>
  <line x1="458" y1="112" x2="612" y2="112" stroke="#1a3d2e" stroke-width="0.8"/>
  <text x="535" y="130" text-anchor="middle" fill="#cbd5e1" font-size="9">mdtraj · scipy · numpy</text>
  <text x="535" y="146" text-anchor="middle" fill="#64748b" font-size="8">CSAA surface · COM · rolling mean</text>
  <text x="535" y="160" text-anchor="middle" fill="#64748b" font-size="8">dist_surface · dist_com · dist_smooth</text>
  <rect x="460" y="170" width="150" height="18" rx="4" fill="#0f3d2a" stroke="#1a3d2e"/>
  <text x="535" y="182" text-anchor="middle" fill="#6ee7b7" font-size="8">→ physical.csv + surface.csv</text>

  <!-- Arrow: fetch_pdb → compute_physical -->
  <line x1="380" y1="132" x2="438" y2="132" stroke="#38bdf8" stroke-width="1.2" marker-end="url(#arrow-blue)"/>

  <!-- ═══════════════ STAGE 3: fetch_annotations ═══════════════ -->
  <rect x="440" y="240" width="190" height="130" rx="8" fill="#1e1640" stroke="#a78bfa" stroke-width="1.2"/>
  <circle cx="458" cy="258" r="8" fill="#a78bfa" opacity="0.2"/>
  <text x="458" y="262" text-anchor="middle" fill="#a78bfa" font-size="9" font-weight="700">3</text>
  <text x="543" y="262" text-anchor="middle" fill="#a78bfa" font-size="11" font-weight="600">fetch_annotations</text>
  <line x1="458" y1="270" x2="612" y2="270" stroke="#2d2060" stroke-width="0.8"/>
  <text x="535" y="288" text-anchor="middle" fill="#cbd5e1" font-size="9">Ensembl REST API</text>
  <text x="535" y="304" text-anchor="middle" fill="#64748b" font-size="8">/sequence/region → GC content</text>
  <text x="535" y="318" text-anchor="middle" fill="#64748b" font-size="8">/overlap/region → gene density</text>
  <rect x="460" y="328" width="150" height="18" rx="4" fill="#251a50" stroke="#2d2060"/>
  <text x="535" y="340" text-anchor="middle" fill="#c4b5fd" font-size="8">→ annotations.csv</text>

  <!-- Parallel badge -->
  <rect x="388" y="218" width="66" height="20" rx="10" fill="#1e293b" stroke="#475569" stroke-width="0.8"/>
  <text x="421" y="232" text-anchor="middle" fill="#94a3b8" font-size="8" font-weight="600">parallel</text>

  <!-- Arrow: input → fetch_annotations (curves down) -->
  <path d="M 170 142 L 190 142 Q 200 142 200 160 L 200 300 Q 200 310 210 310 L 438 310" fill="none" stroke="#64748b" stroke-width="1.2" marker-end="url(#arrow)"/>

  <!-- ═══════════════ STAGE 4: compile ═══════════════ -->
  <rect x="690" y="150" width="180" height="138" rx="8" fill="#2d1a08" stroke="#fb923c" stroke-width="1.2"/>
  <circle cx="708" cy="168" r="8" fill="#fb923c" opacity="0.2"/>
  <text x="708" y="172" text-anchor="middle" fill="#fb923c" font-size="9" font-weight="700">4</text>
  <text x="788" y="172" text-anchor="middle" fill="#fb923c" font-size="11" font-weight="600">compile</text>
  <line x1="708" y1="180" x2="852" y2="180" stroke="#3d2510" stroke-width="0.8"/>
  <text x="780" y="198" text-anchor="middle" fill="#cbd5e1" font-size="9">polars · pyarrow</text>
  <text x="780" y="214" text-anchor="middle" fill="#64748b" font-size="8">merge physical + annotations</text>
  <text x="780" y="228" text-anchor="middle" fill="#64748b" font-size="8">schema enforcement · Float32</text>
  <rect x="708" y="240" width="154" height="18" rx="4" fill="#3d2510" stroke="#4d3018"/>
  <text x="785" y="252" text-anchor="middle" fill="#fdba74" font-size="8">→ compiled.parquet</text>
  <rect x="708" y="262" width="154" height="18" rx="4" fill="#3d2510" stroke="#4d3018"/>
  <text x="785" y="274" text-anchor="middle" fill="#fdba74" font-size="8">→ surface.parquet</text>

  <!-- Join badge -->
  <rect x="647" y="208" width="36" height="20" rx="10" fill="#1e293b" stroke="#475569" stroke-width="0.8"/>
  <text x="665" y="221" text-anchor="middle" fill="#94a3b8" font-size="8" font-weight="600">join</text>

  <!-- Arrow: compute_physical → compile -->
  <path d="M 630 150 L 660 150 Q 670 150 670 165 L 670 200 Q 670 210 680 210 L 688 210" fill="none" stroke="#34d399" stroke-width="1.2" marker-end="url(#arrow-green)"/>

  <!-- Arrow: fetch_annotations → compile -->
  <path d="M 630 310 L 660 310 Q 670 310 670 290 L 670 240 Q 670 230 680 230 L 688 230" fill="none" stroke="#a78bfa" stroke-width="1.2" marker-end="url(#arrow-purple)"/>

  <!-- ═══════════════ OUTPUT ═══════════════ -->
  <rect x="690" y="320" width="180" height="58" rx="8" fill="#1e293b" stroke="#334155" stroke-width="1.2"/>
  <text x="780" y="342" text-anchor="middle" fill="#94a3b8" font-size="9" font-weight="600" letter-spacing="1">OUTPUT</text>
  <text x="780" y="360" text-anchor="middle" fill="#e2e8f0" font-size="10">results/chr{N}_compiled.parquet</text>
  <text x="780" y="372" text-anchor="middle" fill="#94a3b8" font-size="9">results/chr{N}_surface.parquet</text>

  <!-- Arrow: compile → output -->
  <line x1="780" y1="288" x2="780" y2="318" stroke="#fb923c" stroke-width="1.2" marker-end="url(#arrow-orange)"/>

  <!-- ═══════════════ DATA SOURCES (bottom) ═══════════════ -->
  <rect x="30" y="420" width="840" height="80" rx="8" fill="#1e293b" stroke="#334155" stroke-width="0.8"/>
  <text x="450" y="442" text-anchor="middle" fill="#64748b" font-size="9" font-weight="600" letter-spacing="1.5">DATA SOURCES &amp; TOOLS</text>

  <!-- GSDB -->
  <rect x="50" y="452" width="150" height="36" rx="6" fill="#0c2d48" stroke="#1e3a5f"/>
  <text x="125" y="468" text-anchor="middle" fill="#7dd3fc" font-size="9" font-weight="500">GSDB 3DMax</text>
  <text x="125" y="480" text-anchor="middle" fill="#475569" font-size="7.5">H1-hESC · 500kb · PDB</text>

  <!-- Ensembl -->
  <rect x="220" y="452" width="150" height="36" rx="6" fill="#1e1640" stroke="#2d2060"/>
  <text x="295" y="468" text-anchor="middle" fill="#c4b5fd" font-size="9" font-weight="500">Ensembl REST API</text>
  <text x="295" y="480" text-anchor="middle" fill="#475569" font-size="7.5">GRCh38 · sequence · overlap</text>

  <!-- Docker -->
  <rect x="390" y="452" width="130" height="36" rx="6" fill="#172130" stroke="#253549"/>
  <text x="455" y="468" text-anchor="middle" fill="#94a3b8" font-size="9" font-weight="500">Docker</text>
  <text x="455" y="480" text-anchor="middle" fill="#475569" font-size="7.5">python:3.11-slim</text>

  <!-- Python Stack -->
  <rect x="540" y="452" width="150" height="36" rx="6" fill="#172130" stroke="#253549"/>
  <text x="615" y="468" text-anchor="middle" fill="#94a3b8" font-size="9" font-weight="500">Python Stack</text>
  <text x="615" y="480" text-anchor="middle" fill="#475569" font-size="7.5">polars · mdtraj · scipy · numpy</text>

  <!-- Nextflow -->
  <rect x="710" y="452" width="150" height="36" rx="6" fill="#172130" stroke="#253549"/>
  <text x="785" y="468" text-anchor="middle" fill="#94a3b8" font-size="9" font-weight="500">Nextflow DSL2</text>
  <text x="785" y="480" text-anchor="middle" fill="#475569" font-size="7.5">channels · resume · -profile docker</text>

  <!-- ═══════════════ MAPPING FILE CALLOUT ═══════════════ -->
  <rect x="220" y="360" width="170" height="36" rx="6" fill="#1e293b" stroke="#334155" stroke-dasharray="4,3"/>
  <text x="305" y="377" text-anchor="middle" fill="#94a3b8" font-size="8.5">mapping file</text>
  <text x="305" y="390" text-anchor="middle" fill="#64748b" font-size="7.5">bead → chr:start-end (500kb bins)</text>

  <!-- Dashed arrow: mapping → fetch_annotations -->
  <path d="M 390 378 L 430 378 Q 440 378 440 360 L 440 310" fill="none" stroke="#475569" stroke-width="0.8" stroke-dasharray="4,3" marker-end="url(#arrow)"/>

</svg>
